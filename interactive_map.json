{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "vconcat": [
    {
      "width": 700,
      "height": 450,
      "title": {
        "text": "Average Population of Australian States and Territories",
        "fontSize": 20,
        "font": "Arial",
        "fontWeight": "bold",
        "color": "#333333"
      },
      "projection": {"type": "mercator", "scale": 650, "center": [135, -10]},
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/wkiy0001/3179/refs/heads/main/output.json",
            "format": {
              "type": "topojson",
              "feature": "australia-with-states_782"
            }
          },
          "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
            "format": {"type": "topojson", "feature": "oceans"}
          },
          "mark": {"type": "geoshape", "fill": "skyblue"}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/wkiy0001/3179/refs/heads/main/Population_Persons_by_State_Year.csv"
          },
          "transform": [
            {"filter": {"param": "brush"}},
            {
              "groupby": ["State"],
              "aggregate": [
                {
                  "op": "mean",
                  "field": "Population",
                  "as": "AveragePopulation"
                },
                {"op": "min", "field": "Year", "as": "StartYear"},
                {"op": "max", "field": "Year", "as": "EndYear"}
              ]
            },
            {
              "window": [
                {
                  "op": "sum",
                  "field": "AveragePopulation",
                  "as": "TotalPopulation"
                }
              ],
              "frame": [null, null]
            },
            {
              "calculate": "datum.AveragePopulation / datum.TotalPopulation * 100",
              "as": "PopulationPercentage"
            },
            {
              "lookup": "State",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/wkiy0001/3179/refs/heads/main/output.json",
                  "format": {
                    "type": "topojson",
                    "feature": "australia-with-states_782"
                  }
                },
                "key": "properties.STATE_NAME"
              },
              "as": "geo"
            }
          ],
          "mark": {"type": "geoshape", "stroke": "white"},
          "encoding": {
            "shape": {"field": "geo", "type": "geojson"},
            "color": {
              "field": "AveragePopulation",
              "type": "quantitative",
              "title": "Avg Population",
              "scale": {
                "domain": [200000, 9000000],
                "range": ["#e5f5e0", "#31a354"]
              }
            },
            "tooltip": [
              {"field": "State", "type": "nominal", "title": "State/Territory"},
              {
                "field": "AveragePopulation",
                "type": "quantitative",
                "title": "Average Population",
                "format": ",.0f"
              },
              {
                "field": "PopulationPercentage",
                "type": "quantitative",
                "title": "Population Percentage",
                "format": ".1f"
              },
              {
                "field": "StartYear",
                "type": "quantitative",
                "title": "Start Year"
              },
              {"field": "EndYear", "type": "quantitative", "title": "End Year"}
            ]
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
            "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
          },
          "mark": {"type": "geoshape", "fill": null, "stroke": "royalblue"}
        },
        {
          "data": {
            "values": [
              {"state": "NSW", "center": [145.612793, -32.840233]},
              {"state": "Vic.", "center": [144.9646, -38.8201]},
              {"state": "Qld", "center": [144.702789, -23.917574]},
              {"state": "SA", "center": [136.209152, -31.5]},
              {"state": "WA", "center": [122.793221, -26.042261]},
              {"state": "Tas.", "center": [146.8087, -42.5409]},
              {"state": "NT", "center": [133.550964, -21.491411]},
              {"state": "ACT", "center": [149.0124, -35.4735]}
            ]
          },
          "mark": {
            "type": "text",
            "align": "center",
            "dy": -30,
            "fontSize": 12,
            "fontWeight": "normal",
            "color": "black"
          },
          "encoding": {
            "longitude": {"field": "center[0]", "type": "quantitative"},
            "latitude": {"field": "center[1]", "type": "quantitative"},
            "text": {"field": "state", "type": "nominal"}
          }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/wkiy0001/3179/refs/heads/main/Population_Persons_by_State_Year.csv"
          },
          "transform": [
            {"filter": {"param": "brush"}},
            {
              "groupby": ["State"],
              "aggregate": [
                {"op": "mean", "field": "Population", "as": "AveragePopulation"}
              ]
            },
            {
              "window": [
                {
                  "op": "sum",
                  "field": "AveragePopulation",
                  "as": "TotalPopulation"
                }
              ],
              "frame": [null, null]
            },
            {
              "calculate": "datum.AveragePopulation / datum.TotalPopulation * 100",
              "as": "PopulationPercentage"
            },
            {
              "calculate": "format(datum.PopulationPercentage, '.1f') + '%'",
              "as": "FormattedPercentage"
            },
            {
              "lookup": "State",
              "from": {
                "data": {
                  "values": [
                    {
                      "state": "New South Wales",
                      "center": [145.612793, -32.840233]
                    },
                    {"state": "Victoria", "center": [144.9646, -38.3201]},
                    {"state": "Queensland", "center": [144.702789, -23.917574]},
                    {"state": "South Australia", "center": [136.209152, -31.5]},
                    {
                      "state": "Western Australia",
                      "center": [122.793221, -26.042261]
                    },
                    {"state": "Tasmania", "center": [146.8087, -42.5409]},
                    {
                      "state": "Northern Territory",
                      "center": [133.550964, -21.491411]
                    },
                    {
                      "state": "Australian Capital Territory",
                      "center": [149.0124, -35.4735]
                    }
                  ]
                },
                "key": "state",
                "fields": ["center"]
              }
            }
          ],
          "mark": {
            "type": "text",
            "align": "center",
            "dy": -10,
            "fontSize": 15,
            "fontWeight": "bold",
            "color": "darkblue"
          },
          "encoding": {
            "longitude": {"field": "center[0]", "type": "quantitative"},
            "latitude": {"field": "center[1]", "type": "quantitative"},
            "text": {"field": "FormattedPercentage", "type": "nominal"}
          }
        }
      ]
    },
    {
      "title": {
        "text": "Use this line chart to select and inspect a period of time",
        "fontSize": 15,
        "font": "Arial",
        "fontWeight": "bold",
        "color": "#333333"
      },
      "width": 700,
      "height": 100,
      "data": {
        "url": "https://raw.githubusercontent.com/wkiy0001/3179hw/refs/heads/main/Population_by_State_Grouped_Year.csv"
      },
      "transform": [
        {
          "fold": ["Natural_Increase", "Net_Overseas_Migration"],
          "as": ["Component", "Value"]
        },
        {"filter": "datum.Year >= 2013"}
      ],
      "layer": [
        {
          "mark": "line",
          "encoding": {
            "x": {
              "field": "Year",
              "type": "quantitative",
              "title": "Year",
              "scale": {"domain": [2013, 2023]},
              "axis": {"format": "d"}
            },
            "y": {
              "field": "Value",
              "type": "quantitative",
              "title": "Population Change"
            },
            "color": {
              "field": "Component",
              "type": "nominal",
              "title": "Component of Population Growth",
              "legend": {"orient": "right"}
            },
            "tooltip": [
              {"field": "Component", "type": "nominal", "title": "Component"},
              {"field": "Year", "type": "quantitative", "title": "Year"},
              {"field": "Value", "type": "quantitative", "title": "Value"}
            ]
          }
        },
        {
          "mark": "rule",
          "encoding": {
            "x": {"field": "Year", "type": "quantitative"},
            "color": {"value": "red"},
            "opacity": {"value": 0.5}
          },
          "data": {
            "values": [
              {"Year": "2019", "text": "COVID-19 pandemic"},
              {"Year": "2022", "text": "Border reopened"}
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 75,
            "dy": -30,
            "fontSize": 11,
            "color": "red"
          },
          "encoding": {"text": {"field": "text", "type": "nominal"}},
          "data": {"values": [{"Year": "2019", "text": "COVID-19 pandemic"}]}
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "baseline": "middle",
            "dx": 285,
            "dy": -5,
            "fontSize": 11,
            "color": "red"
          },
          "encoding": {"text": {"field": "text", "type": "nominal"}},
          "data": {"values": [{"Year": "2022", "text": "Border reopened"}]}
        },
        {
          "mark": "rect",
          "params": [
            {
              "name": "brush",
              "select": {"type": "interval", "encodings": ["x"]}
            }
          ],
          "encoding": {
            "x": {
              "field": "Year",
              "type": "quantitative",
              "scale": {"domain": [2013, 2023]}
            },
            "opacity": {"condition": {"param": "brush", "value": 0}, "value": 0}
          }
        }
      ]
    },
    {
      "width": 700,
      "height": 300,
      "title": {
        "text": "Total Population Growth Components by State in Australia",
        "fontSize": 20,
        "font": "Arial",
        "fontWeight": "bold",
        "color": "#333333"
      },
      "data": {
        "url": "https://raw.githubusercontent.com/wkiy0001/3179/refs/heads/main/Population_by_State_Grouped_Year.csv"
      },
      "transform": [
        {
          "filter": {
            "or": [{"param": "brush"}, {"field": "State", "equal": "NSW"}]
          }
        },
        {
          "aggregate": [
            {
              "op": "sum",
              "field": "Natural_Increase",
              "as": "Natural_Increase"
            },
            {
              "op": "sum",
              "field": "Net_Interstate_Migration",
              "as": "Net_Interstate_Migration"
            },
            {
              "op": "sum",
              "field": "Net_Overseas_Migration",
              "as": "Net_Overseas_Migration"
            },{
                  "op": "sum",
                  "field": "Value",
                  "as": "Total_Population_Change"
                },
            {"op": "min", "field": "Year", "as": "StartYear"},
            {"op": "max", "field": "Year", "as": "EndYear"}
          ],
          "groupby": ["State"]
        },
        {
          "fold": [
            "Natural_Increase",
            "Net_Interstate_Migration",
            "Net_Overseas_Migration"
          ],
          "as": ["Component", "Value"]
        }
      ],
     "layer": [
        {
          "mark": "bar",
          "encoding": {
            "x": {
              "field": "State",
              "type": "nominal",
              "axis": {"title": "State", "labelAngle": -45},
              "sort": [
                "New South Wales",
                "Victoria",
                "Queensland",
                "Western Australia",
                "South Australia",
                "Australian Capital Territory",
                "Northern Territory",
                "Tasmania"
              ]
            },
            "y": {
              "field": "Value",
              "type": "quantitative",
              "axis": {"title": "Total Population Change"},
              "stack": "zero"
            },
            "color": {
              "field": "Component",
              "type": "nominal",
              "scale": {
                "domain": [
                  "Natural_Increase",
                  "Net_Interstate_Migration",
                  "Net_Overseas_Migration"
                ],
                "range": ["#ff7f0e", "#404080", "#69b3a2"]
              },
              "legend": {"title": "Growth Component", "orient": "right"}
            },
            "tooltip": [
              {"field": "State", "type": "nominal"},
              {"field": "Component", "type": "nominal"},
              {
                "field": "Value",
                "type": "quantitative",
                "format": ",.0f",
                "title": "Total Change"
              },
              {
                "field": "StartYear",
                "type": "quantitative",
                "title": "Start Year"
              },
              {"field": "EndYear", "type": "quantitative", "title": "End Year"}
            ]
          }
        },
        {
          "transform": [
            {
              "aggregate": [
                {
                  "op": "sum",
                  "field": "Value",
                  "as": "Total_Population_Change"
                },
                {"op": "min", "field": "StartYear", "as": "StartYear"},
                {"op": "max", "field": "EndYear", "as": "EndYear"}
              ],
              "groupby": ["State"]
            }
          ],
          "mark": {"type": "line", "color": "black", "strokeWidth": 2},
          "encoding": {
            "x": {
              "field": "State",
              "type": "nominal",
              "axis": {"title": "State", "labelAngle": -45},
              "sort": [
                "New South Wales",
                "Victoria",
                "Queensland",
                "Western Australia",
                "South Australia",
                "Australian Capital Territory",
                "Northern Territory",
                "Tasmania"
              ]
            },
            "y": {"field": "Total_Population_Change", "type": "quantitative"},
            "tooltip": [
              {"field": "State", "type": "nominal"},
              {
                "field": "Total_Population_Change",
                "type": "quantitative",
                "format": ",.0f",
                "title": "Total Population Change"
              },
              {
                "field": "StartYear",
                "type": "quantitative",
                "title": "Start Year"
              },
              {"field": "EndYear", "type": "quantitative", "title": "End Year"}
            ]
          }
        }
      ]
    }
  ],
  "spacing": 70
}
